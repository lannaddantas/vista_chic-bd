<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vista Chic</title>

    <link rel="icon" href="img/vclogo.png">
    <link rel="stylesheet" href="estilo.css">
    <link rel="stylesheet" href="cadastro.css">
    <style>
        body {
            background-image: url('./img/vcfundo.png');
            /* LINK da imagem */
            background-size: cover;
            /* cobre toda a tela */
            background-repeat: no-repeat;
            /* não repete */
            background-position: center;
            /* centraliza */
        }
    </style>
    <script>
        // Capitaliza a primeira letra de cada palavra
        function capitalizarNome(nome) {
            return nome.toLowerCase().replace(/\b\w/g, function (letra) {
                return letra.toUpperCase();
            });
        }

        // Validação + Capitalização
        function valFormulario() {
            const nomeInput = document.getElementById('tNome');
            const emailInput = document.getElementById('tEmail');
            const senhaInput = document.getElementById('tSenha');

            const nome = nomeInput.value.trim();
            const email = emailInput.value.trim();
            const senha = senhaInput.value;

            if (nome === '' || email === '' || senha === '') {
                alert('Por favor, preencha todos os campos.');
                return false;
            }

            if (senha.length < 6 || senha.length > 8) {
                alert('A senha deve ter entre 6 e 8 caracteres.');
                return false;
            }

            // ✅ Capitaliza o nome antes de enviar
            nomeInput.value = capitalizarNome(nome);

            return true; // Envia o formulário
        }
    </script>
</head>

<body>
    <div id="interface">

        <!-- start header -->
        <header>
            <nav class="navbar">
                <ul>
                    <li><a href="inicio.html">Inicio</a></li>
                    <li><a href="login.html">Login</a></li>
                    <li><a href="paginadehistoria.html">Pagina de Historia</a></li>
                    <li><a href="produtos.html">Produtos</a></li>
                    <li><a href="cadastro.html">Cadastro Cliente</a></li>
                    <li><a href="cadastroproduto.html">Cadastro Produto</a></li>
                    <li><a href="cadastroPedido.html">Cadastro Pedido</a></li>
                    <li><a href="./tabela1/consulta_cliente.php">Consulta Cliente</a></li>
                    <li><a href="./tabela1/consulta_produto.php">Consulta Produto</a></li>
                    <li><a href="./tabela1/criar_indices.php">Indices</a></li>
                </ul>
            </nav>
            <div class="titulo">
                <h1>Vista Chic</h1>

            </div>

        </header>
        <!-- conteúdo principal -->
        <main>
            <div class="cadastro">

                <!-- <form id="formCadastro"> -->
                <form id="formMatricula" action="tabela1/cadastro_pedido.php" method="post"
                    onsubmit="return valFormulario();">
                    <fieldset>

                        <select id="selectCliente"></select>
                        <select id="selectProduto"></select>


                        <div class="botoes">
                            <input type="reset" value="limpar" class="limpar">
                            <input type="submit" value="enviar" class="enviar">
                        </div>
                    </fieldset>
                </form>

                <script>

                    function salvarNoStorage(objeto) {
                        localStorage.setItem("dados4", JSON.stringify(objeto));
                    }

                    function carregarDoStorage() {
                        return JSON.parse(localStorage.getItem("dados4")) || { cliente: [], produto: [], pedido: [] };
                    }

                    function atualizarSelects() {
                        const dados = carregarDoStorage();
                        const selectCliente = document.getElementById("formCadastro");
                        const selectProduto = document.getElementById("formCadastroproduto");

                        selectCliente.innerHTML = "";
                        selectProduto.innerHTML = "";

                        dados.cliente.forEach(a => {
                            let opt = document.createElement("option");
                            opt.value = a.id;
                            opt.textContent = `${a.nome} ${a.email} (${a.senha})`;
                            selectCliente.appendChild(opt);
                        });

                        dados.produto.forEach(d => {
                            let opt = document.createElement("option");
                            opt.value = d.id;
                            opt.textContent = `${d.nome} (${d.preco}) ${d.marca} ${d.tipo} ${d.tamanho} (${d.quantidade})`;
                            selectProduto.appendChild(opt);
                        });
                    }

                    document.getElementById("formPedido").addEventListener("submit", function (e) {
                        e.preventDefault();
                        const dados = carregarDoStorage();
                        const clienteId = parseInt(document.getElementById("selectCliente").value);
                        const pedidoId = parseInt(document.getElementById("selectPedido").value);

                        // Evitar duplicata
                        if (dados.matriculas.some(m => m.clienteId === clienteId && m.pedidoId === pedidoId)) {
                            alert("cliente já está matriculado nesta pedido!");
                            return;
                        }

                        dados.matriculas.push({ clienteId, pedidoId });
                        salvarNoStorage(dados);
                        alert("Matrícula realizada!");
                    });

                    atualizarSelects();
                </script>
                <button class="enviar" onclick="window.location.href='consultaPedido.html'">Ir para Consulta JSON</button>
            </div>
        </main>

        <!-- rodapé -->
        <footer class="rodape">
            <div class="slogan">
                <h2>Trabalho desenvolvido por: Laércio, Lanna, Maria Clara</h2>
            </div>
        </footer>
    </div>
</body>

</html>